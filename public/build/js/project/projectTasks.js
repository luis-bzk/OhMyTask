import{getProjectUrl,cleanTasksHTML}from"./functions.js";import{showAlert}from"./newTasks.js";import{tasks,setTasks}from"./globalVariables.js";const updateTask=async function(t){const{id:e,name:s,state:a}=t,n=new FormData;n.append("id",e),n.append("name",s),n.append("state",a),n.append("project_id",getProjectUrl());try{const t="http://localhost:3000/api/task/update",s=await fetch(t,{method:"POST",body:n}),o=await s.json();if("succes"===o.answerUpdate.type){const t=document.querySelector(".container-new-task"),{message:s,type:n}=o.answerUpdate;showAlert(s,n,t);const c=tasks.map(t=>(t.id===e&&(t.state=a),t));setTasks(c),showTasks()}}catch(t){console.log(t)}},changeTaskState=t=>{const e="1"===t.state?"0":"1";t.state=e,updateTask(t)},confirmDeleteTask=t=>{const e=Swal.mixin({customClass:{confirmButton:"sweetalert btn-success",cancelButton:"sweetalert btn-danger",title:"sweetalert text",actions:"sweetalert actions"},buttonsStyling:!1});e.fire({title:"Are you sure you want to delete this Task?",icon:"warning",showCancelButton:!0,confirmButtonText:"Yes, delete it!",cancelButtonText:"No, cancel!",reverseButtons:!0,width:600}).then(e=>{e.isConfirmed&&async function(t){const{id:e,name:s,state:a}=t,n=new FormData;n.append("id",e),n.append("name",s),n.append("state",a),n.append("project_id",getProjectUrl());try{const e="http://localhost:3000/api/task/delete",s=await fetch(e,{method:"POST",body:n}),a=await s.json(),{result:o,message:c,type:d}=a.deleteResult,l=document.querySelector(".container-new-task");o&&(showAlert(c,d,l),setTasks(tasks.filter(e=>e.id!==t.id)),showTasks())}catch(t){console.log(t)}}(t)})};export const showTasks=()=>{if(cleanTasksHTML(),0===tasks.length){const t=document.querySelector("#tasks-list"),e=document.createElement("DIV");return e.textContent="There aren't tasks",e.classList.add("not-tasks"),void t.appendChild(e)}const t={0:"Pending",1:"Complete"};tasks.forEach(e=>{const s=document.querySelector("#tasks-list"),a=document.createElement("LI");a.classList.add("task"),a.dataset.taskId=e.id;const n=document.createElement("P");n.textContent=e.name,n.classList.add("task__name");const o=document.createElement("DIV");o.classList.add("task__options");const c=document.createElement("BUTTON");c.classList.add("task-state"),c.classList.add(""+t[e.state].toLowerCase()),c.textContent=t[e.state],c.dataset.taskState=e.state,c.ondblclick=function(){changeTaskState({...e})};const d=document.createElement("BUTTON");d.classList.add("task-delete"),d.textContent="Delete",d.dataset.taskDelete=e.id,d.ondblclick=function(){confirmDeleteTask({...e})},o.appendChild(c),o.appendChild(d),a.appendChild(n),a.appendChild(o),s.appendChild(a)})};export const getTasks=async function(){try{const t="/api/tasks?id="+getProjectUrl(),e=await fetch(t),s=await e.json();setTasks(s.tasks),showTasks()}catch(t){console.log(t)}};