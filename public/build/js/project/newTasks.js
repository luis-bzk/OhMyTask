import{getProjectUrl,cleanTasksHTML}from"./functions.js";import{tasks,setTasks}from"./globalVariables.js";import{showTasks}from"./projectTasks.js";export const showAlert=(e,t,s)=>{const a=document.querySelector(".alert");a&&a.remove();const o=document.createElement("DIV");o.classList.add("alert",t),"error"===t?o.innerHTML=e+' <i class="fa-solid fa-triangle-exclamation"></i>\n      ':o.textContent=e,s.parentElement.insertBefore(o,s.nextElementSibling),setTimeout(()=>{o.remove()},5e3)};const addNewTask=async function(e){const t=document.querySelector(".form-task legend"),s=new FormData;s.append("name",e),s.append("project_id",getProjectUrl());try{const a="http://localhost:3000/api/task",o=await fetch(a,{method:"POST",body:s}),n=await o.json();if(showAlert(n.message,n.type,t),"succes"===n.type){const t=document.querySelector(".modal"),s=document.querySelector(".form-task");setTimeout(()=>{s.classList.add("close"),setTimeout(()=>{t.remove()},500)},2e3);const a={id:String(n.id),name:e,state:"0",project_id:n.project_id};setTasks([...tasks,a]),showTasks()}}catch(e){console.log(e)}},submitNewTaskForm=()=>{const e=document.querySelector("#taskName").value.trim(),t=document.querySelector(".form-task legend");e?e.length>60?showAlert("The task name cannot be greater that 60 characters","error",t):addNewTask(e):showAlert("You need to set a Task Name","error",t)};export const showTaskForm=()=>{const e=document.createElement("DIV");e.classList.add("modal"),e.innerHTML='\n    <form class="form-task container-md">\n      <legend>Add new task</legend>\n\n      <div class="field">\n        <label for="taskName">Task Name</label>\n        <input type="text" id="taskName" name="taskName" value="" />\n      </div>\n\n      <div class="field form-task__buttons">\n        <input type="submit" class="button-new-task" value="Add task" />\n        <button type="button" class="close-modal">\n          Cancel\n        </button>\n      </div>\n    </form>\n    ',setTimeout(()=>{document.querySelector(".form-task").classList.add("animation")},100),e.addEventListener("click",(function(t){if(t.preventDefault(),t.target.classList.contains("close-modal")){document.querySelector(".form-task").classList.add("close"),setTimeout(()=>{e.remove()},500)}t.target.classList.contains("button-new-task")&&submitNewTaskForm()})),document.querySelector(".dashboard").appendChild(e)};