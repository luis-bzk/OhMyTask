import{getProjectUrl,cleanTasksHTML}from"./functions.js";import{tasks,setTasks}from"./globalVariables.js";import{showTasks,updateTask}from"./projectTasks.js";export const showAlert=(t,e)=>{Swal.mixin({customClass:{title:"sweetalert title",confirmButton:"sweetalert btn-success"},buttonsStyling:!1}).fire({title:t,icon:e,width:600})};const addNewTask=async function(t){const e=new FormData;e.append("name",t),e.append("project_id",getProjectUrl());try{const s="http://localhost:3000/api/task",a=await fetch(s,{method:"POST",body:e}),o=await a.json();if(showAlert(o.message,o.type),"success"===o.type){const e=document.querySelector(".modal"),s=document.querySelector(".form-task");setTimeout(()=>{s.classList.add("close"),setTimeout(()=>{e.remove()},500)},1e3);const a={id:String(o.id),name:t,state:"0",project_id:o.project_id};setTasks([...tasks,a]),showTasks()}}catch(t){console.log(t)}},setTaskValidation=(t,e)=>{const s=document.querySelector("#taskName").value.trim();s?s.length>60?showAlert("The task name cannot be greater that 60 characters","error"):(t&&(e.name=s,updateTask(e)),!1===t&&addNewTask(s)):showAlert("You need to set a Task Name","error")};export const showTaskForm=(t=!1,e={})=>{const s=document.createElement("DIV");s.classList.add("modal"),s.innerHTML=`\n    <form class="form-task container-md">\n      <legend>${t?"Edit task":"Add new task"}</legend>\n\n      <div class="field">\n        <label for="taskName">Task Name</label>\n        <input type="text" id="taskName" name="taskName" value="${e.name?e.name:""}" />\n      </div>\n\n      <div class="field form-task__buttons">\n        <input type="submit" class="button-new-task" value="${e.name?"Save Changes":"Add New Task"}" />\n        <button type="button" class="close-modal">\n          Cancel\n        </button>\n      </div>\n    </form>\n    `,setTimeout(()=>{document.querySelector(".form-task").classList.add("animation")},100),s.addEventListener("click",(function(a){if(a.preventDefault(),a.target.classList.contains("close-modal")){document.querySelector(".form-task").classList.add("close"),setTimeout(()=>{s.remove()},500)}a.target.classList.contains("button-new-task")&&setTaskValidation(t,e)})),document.querySelector(".dashboard").appendChild(s)};